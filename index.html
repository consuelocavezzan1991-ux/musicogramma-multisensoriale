<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <title>Registrazione punti - Danza delle ore</title>
    <style>
      body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: #f4f4f8;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      header {
        text-align: center;
        padding: 20px 10px 10px;
      }

      h1 {
        margin: 0;
        font-size: 1.8rem;
      }

      p.subtitle {
        margin: 5px 0 0;
        color: #555;
        font-size: 0.95rem;
      }

      #canvas-container {
        margin: 20px 0 30px;
        border-radius: 16px;
        overflow: hidden;
      }

      #status {
        font-size: 0.9rem;
        color: #333;
        text-align: center;
        padding: 0 10px 15px;
      }
    </style>
  </head>

  <body>
    <header>
      <h1>Registrazione punti – Danza delle ore</h1>
      <p class="subtitle">
        Clicca in ordine al centro di ogni figura (anche senza musica).
      </p>
    </header>

    <div id="status">
      1. Aspetta che si carichi l'immagine. <br />
      2. Poi apri la console (F12 → Console) e clicca in ordine tutte le figure.
    </div>

    <div id="canvas-container"></div>

    <!-- p5.js (solo grafica, niente audio per ora) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

    <script>
      let danzaImg;
      let punti = [];

      function preload() {
        // carichiamo SOLO l'immagine del musicogramma di Danza
        danzaImg = loadImage("danza_musicogramma.png");
      }

      function setup() {
        const canvas = createCanvas(900, 600);
        canvas.parent("canvas-container");

        textAlign(CENTER, CENTER);
        textSize(18);
      }

      function draw() {
        background(244);

        if (!danzaImg) {
          fill(80);
          text("Caricamento immagine...", width / 2, height / 2);
          return;
        }

        imageMode(CENTER);
        const imgW = width * 0.8;
        const imgH = height * 0.8;

        // bordino bianco
        fill(255);
        noStroke();
        rectMode(CENTER);
        rect(width / 2, height / 2, imgW + 8, imgH + 8, 18);

        // disegno il musicogramma
        image(danzaImg, width / 2, height / 2, imgW, imgH);

        // disegno anche i punti già registrati
        if (punti.length > 0) {
          fill(0, 140, 255);
          noStroke();
          const imgX = width / 2 - imgW / 2;
          const imgY = height / 2 - imgH / 2;
          for (let p of punti) {
            const x = imgX + p.u * imgW;
            const y = imgY + p.v * imgH;
            ellipse(x, y, 10);
          }
        }
      }

      // QUI REGISTRIAMO I PUNTI QUANDO CLICCHI
      function mousePressed() {
        if (!danzaImg) return;

        const imgW = width * 0.8;
        const imgH = height * 0.8;
        const imgX = width / 2 - imgW / 2;
        const imgY = height / 2 - imgH / 2;

        // se clicchi fuori dal musicogramma, ignoro
        if (
          mouseX < imgX ||
          mouseX > imgX + imgW ||
          mouseY < imgY ||
          mouseY > imgY + imgH
        ) {
          return;
        }

        // coordinate normalizzate (0..1)
        const u = (mouseX - imgX) / imgW;
        const v = (mouseY - imgY) / imgH;

        const punto = { u: u, v: v };
        punti.push(punto);

        // stampiamo in console in formato pronto per pathDanza
        console.log(
          punti.length + ":",
          `{ u: ${u.toFixed(2)}, v: ${v.toFixed(2)} },`
        );

        // aggiorno status a schermo
        const status = document.getElementById("status");
        status.textContent =
          "Punti registrati: " +
          punti.length +
          ". Guarda la console (F12 → Console) e alla fine copia tutti i punti.";
      }
    </script>
  </body>
</html>

















